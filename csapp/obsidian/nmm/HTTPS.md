## HTTPS가 뭔데??
#### 기존 HTTP의 문제점
HTTP는 평문 통신이라서 네트워크에서 패킷을 가로채면 요청과 응답 내용이 그대로 보이게 됩니다.
따라서 아이디, 비밀번호, 쿠키, 토큰이 쉽게 탈취될 수 있고 공용 와이파이, 프록시 환경에서 중간자 공격(MITM)에 취약하다는 문제점을 가지게 됩니다.

#### HTTPS의 정의와 보안요소
![[ServerArchitecture.png]]
HTTPS는 HTTP에 TLS(Transport Layer Security)를 결합한 방식으로 아래의 보안 요소를 제공합니다.
- 기밀성: 데이터 암호화
- 무결성: 데이터 변조 방지
- 인증: 인증서를 통한 서버 신원 검증
따라서 HTTPS는 선택이 아니라 필수 보안 인프라라고 할 수 있습니다.

#### TLS 통신 흐름
- 클라이언트가 서버에 접속하면 서버는 **CA(Certificate Authority)가 서명한 TLS 인증서(서버 공개키 포함)** 를 전달한다.
- 브라우저는 인증서의 신뢰성, 도메인 일치, 유효기간을 검증하며, 실패 시 보안 경고를 표시한다.
- 검증이 성공하면 클라이언트는 **대칭키(Session Key)** 를 생성해 서버 공개키로 암호화하여 전달하고, 서버는 개인키로 복호화한다.
- 이후 실제 데이터 통신은 속도가 빠른 대칭키 암호화로 진행되며, 모든 HTTP 요청·응답은 암호화되어 중간에서 내용을 볼 수 없다.

## 그래서 어떻게 프로젝트에 적용하는데??
#### 교통정리의 신, Nginx을 사용해라
- HTTPS의 종료 지점으로, TLS 핸드셰이크와 암호화 처리를 담당한다. (따라서 백엔드 서버는 HTTP만 사용하면서 비즈니스 로직에 집중할 수 있다.)
- 클라이언트 요청을 대신 받아 백엔드 서버로 전달하며 백엔드 서버의 구조와 IP를 외부에 노출하지 않는다. (Reverse Proxy)
- 이벤트 기반, 논블로킹 비동기 처리 구조로 인해 적은 자원으로 다수의 요청 처리가 가능해진다.
- 로드 밸런싱 (여러 백엔드 서버로 트래픽을 분산해서 확장성과 가용성 확보)

#### 인증서 발급과 관리는 Let’s Encrypt + Certbot 조합으로 해결!!
- Let’s Encrypt: 무료 인증기관(CA), 자동화에 적합
- Certbot: 인증서 발급 및 갱신 자동화 도구, Nginx와 연동이 쉬움

🚨 인증서 만료에 주의해야 합니다.
기본 유효기간은 90일이며 인증서가 만료되면 서비스 접속이 불가능해지기 때문에 자동 갱신 설정이 필수입니다.

#### Redirection (HTTP → HTTPS)
사용자는 `http://` 주소로도 서비스에 접속할 수 있기 때문에, 보안이 적용되지 않은 HTTP 요청이 서버로 들어올 수 있습니다.
이를 방지하기 위해 우리는 Nginx에서 HTTP(80 포트)로 들어오는 모든 요청에 대해 페이지를 직접 응답하지 않고, `301 Moved Permanently` 응답을 반환하여 브라우저가 동일한 요청을 HTTPS로 다시 보내도록 설정해야합니다.

```nginx
server {
  listen 80;
  server_name example.com;
  return 301 https://$host$request_uri;
}
```

#### HSTS (HTTP Strict Transport Security)
또한 Nginx는 HSTS라는 보안 정책도 지원합니다.
이는 HTTPS 응답에 `Strict-Transport-Security` 헤더를 추가하여, 브라우저가 해당 도메인에 대해 이후부터는 HTTP 접속을 시도하지 않고 항상 HTTPS만 사용하도록 강제하는 보안 정책입니다.

